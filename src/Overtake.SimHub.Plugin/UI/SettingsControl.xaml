<UserControl x:Class="Overtake.SimHub.Plugin.UI.SettingsControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:styles="clr-namespace:SimHub.Plugins.Styles;assembly=SimHub.Plugins"
             xmlns:ui="clr-namespace:SimHub.Plugins.UI;assembly=SimHub.Plugins"
             Loaded="UserControl_Loaded">

    <UserControl.Resources>
        <SolidColorBrush x:Key="OvertakeTeal" Color="#2EC4B6" />
        <SolidColorBrush x:Key="OvertakeTealDark" Color="#1FA89C" />
        <SolidColorBrush x:Key="OvertakeBg" Color="#1A1A2E" />
        <SolidColorBrush x:Key="OvertakeCardBg" Color="#16213E" />
        <SolidColorBrush x:Key="OvertakeDim" Color="#7B8CA3" />
        <SolidColorBrush x:Key="OvertakeLight" Color="#E0E0E0" />
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">

            <!-- Header / Branding -->
            <Border Background="#16213E" CornerRadius="8" Padding="18,14" Margin="0,0,0,15">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="Overtake Telemetry" FontSize="20" FontWeight="Bold"
                                   Foreground="#2EC4B6" />
                        <TextBlock Text="Capture F1 25 race data and export to Overtake Race Hub."
                                   Foreground="#7B8CA3" FontSize="12" Margin="0,4,0,6" />
                        <TextBlock Foreground="#7B8CA3" FontSize="11">
                            <Hyperlink x:Name="LnkWebsite" Foreground="#2EC4B6"
                                       NavigateUri="https://racehub.overtakef1.com/"
                                       RequestNavigate="Hyperlink_RequestNavigate">
                                racehub.overtakef1.com
                            </Hyperlink>
                            <Run Text="  |  Upload your JSON and get instant results, standings and stats." />
                        </TextBlock>
                    </StackPanel>

                    <StackPanel Grid.Column="1" VerticalAlignment="Top" Margin="10,0,0,0">
                        <TextBlock x:Name="LblVersion" Text="v1.0.0"
                                   Foreground="#3D4F6B" FontSize="11" />
                        <TextBlock x:Name="LblUpdateAvailable" Visibility="Collapsed"
                                   Foreground="#FFD54F" FontSize="10" Margin="0,2,0,0">
                            <Hyperlink x:Name="LnkUpdate" Foreground="#FFD54F"
                                       RequestNavigate="Hyperlink_RequestNavigate">
                                Update available
                            </Hyperlink>
                        </TextBlock>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Capture Status -->
            <styles:SHSection Title="Capture Status">
                <StackPanel Margin="10">

                    <Border x:Name="StatusBanner"
                            Background="#1A1A2E" CornerRadius="6"
                            Padding="15,12" Margin="0,0,0,10">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse x:Name="StatusDot" Width="14" Height="14"
                                     Fill="#F44336" Margin="0,0,10,0"
                                     VerticalAlignment="Center" />
                            <TextBlock x:Name="LblStatusMain"
                                       Text="Waiting for data..."
                                       FontSize="15" FontWeight="SemiBold"
                                       VerticalAlignment="Center" />
                        </StackPanel>
                    </Border>

                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,5">
                            <TextBlock Text="TRACK" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblTrack" Text="&#x2014;" FontSize="14" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,5">
                            <TextBlock Text="SESSION" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblSession" Text="&#x2014;" FontSize="14" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Grid.Row="0" Margin="0,5">
                            <TextBlock Text="DRIVERS" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblDrivers" Text="0" FontSize="14" />
                        </StackPanel>

                        <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,5">
                            <TextBlock Text="PACKETS" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblPackets" Text="0" FontSize="14" />
                        </StackPanel>

                        <StackPanel Grid.Column="1" Grid.Row="1" Margin="0,5">
                            <TextBlock Text="SESSIONS" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblSessions" Text="0" FontSize="14" />
                        </StackPanel>

                        <StackPanel Grid.Column="2" Grid.Row="1" Margin="0,5">
                            <TextBlock Text="LISTENER" FontSize="10" Foreground="#2EC4B6"
                                       FontWeight="Bold" />
                            <TextBlock x:Name="LblStatus" Text="&#x2014;" FontSize="14" />
                        </StackPanel>
                    </Grid>

                    <TextBlock x:Name="LblHelpText"
                               Text="The plugin captures data automatically when F1 25 is running."
                               Foreground="#7B8CA3" FontSize="11" Margin="0,8,0,0"
                               TextWrapping="Wrap" />

                </StackPanel>
            </styles:SHSection>

            <!-- Export -->
            <styles:SHSection Title="Export">
                <StackPanel Margin="10">
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <Button x:Name="BtnExport"
                                Content="&#xE896;  EXPORT LEAGUE JSON"
                                Padding="20,10"
                                FontSize="13"
                                FontWeight="SemiBold"
                                Click="BtnExport_Click" />
                        <Button x:Name="BtnOpenFolder"
                                Content="OPEN FOLDER"
                                Padding="15,10"
                                Margin="10,0,0,0"
                                Click="BtnOpenFolder_Click" />
                    </StackPanel>

                    <TextBlock x:Name="LblExportResult" Text=""
                               Margin="0,0,0,5" TextWrapping="Wrap" FontStyle="Italic" />

                    <StackPanel Orientation="Horizontal" Margin="0,3">
                        <TextBlock Text="Last export: " Foreground="#7B8CA3" />
                        <TextBlock x:Name="LblLastExport" Text="none yet" Foreground="#7B8CA3" />
                    </StackPanel>

                    <CheckBox x:Name="ChkAutoExport"
                              Content="Auto-export JSON when session ends"
                              Margin="0,8,0,0"
                              Checked="ChkAutoExport_Changed"
                              Unchecked="ChkAutoExport_Changed" />

                    <TextBlock Foreground="#7B8CA3" FontSize="11" Margin="0,6,0,0" TextWrapping="Wrap">
                        <Run>Upload your exported JSON at</Run>
                        <Hyperlink Foreground="#2EC4B6"
                                   NavigateUri="https://racehub.overtakef1.com/"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            racehub.overtakef1.com
                        </Hyperlink>
                        <Run>to get instant race results, standings and driver stats.</Run>
                    </TextBlock>
                </StackPanel>
            </styles:SHSection>

            <!-- Settings -->
            <styles:SHSection Title="Settings">
                <StackPanel Margin="10">

                    <TextBlock Text="UDP Port" FontWeight="Bold" Margin="0,0,0,3" />
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBox x:Name="TxtPort"
                                 Width="80"
                                 VerticalContentAlignment="Center"
                                 Margin="0,0,10,0" />
                        <Button x:Name="BtnApplyPort"
                                Content="APPLY"
                                Padding="15,5"
                                Click="BtnApplyPort_Click" />
                        <TextBlock Text="Must match F1 25 telemetry port (default: 20778)"
                                   Foreground="#7B8CA3" FontSize="11"
                                   VerticalAlignment="Center" Margin="10,0,0,0" />
                    </StackPanel>

                    <TextBlock Text="Output Folder" FontWeight="Bold" Margin="0,5,0,3" />
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                        <TextBox x:Name="TxtOutputFolder"
                                 Width="350"
                                 VerticalContentAlignment="Center"
                                 IsReadOnly="True"
                                 Margin="0,0,10,0" />
                        <Button x:Name="BtnBrowse"
                                Content="BROWSE..."
                                Padding="15,5"
                                Click="BtnBrowse_Click" />
                    </StackPanel>

                </StackPanel>
            </styles:SHSection>

            <!-- Setup Guide - PC -->
            <styles:SHSection Title="Setup Guide (PC)">
                <StackPanel Margin="10">
                    <TextBlock TextWrapping="Wrap" Foreground="#CCC" FontSize="12">
                        <Run FontWeight="Bold" Foreground="#2EC4B6">STEP 1 - F1 25 Game Settings:</Run>
                        <LineBreak />
                        <Run>Settings > Telemetry > UDP Telemetry = On</Run>
                        <LineBreak />
                        <Run FontWeight="Bold" Foreground="#FFD54F">UDP IP = 127.0.0.1  |  UDP Port = 20778  |  Format = 2025</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">STEP 2 - SimHub Game Config (IMPORTANT):</Run>
                        <LineBreak />
                        <Run>Go to SimHub Home > Codemasters F1 25 > click "Game config..."</Run>
                        <LineBreak />
                        <Run FontWeight="Bold" Foreground="#FFD54F">Set UDP Port to 20777</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">(SimHub auto-detects 20778 from the game. You MUST change it back to 20777.)</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">How it works:</Run>
                        <LineBreak />
                        <Run>F1 25 (20778)  &#x2192;  Overtake Plugin  &#x2192;  relay  &#x2192;  SimHub (20777)</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">The plugin receives telemetry, processes it, and relays every packet</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">to SimHub so your dashboards keep working normally.</Run>
                    </TextBlock>
                </StackPanel>
            </styles:SHSection>

            <!-- Setup Guide - Console -->
            <styles:SHSection Title="Setup Guide (Console - PS5 / Xbox)">
                <StackPanel Margin="10">
                    <TextBlock TextWrapping="Wrap" Foreground="#CCC" FontSize="12">
                        <Run Foreground="#7B8CA3">F1 25 on PlayStation and Xbox can send telemetry to a PC on the same network.</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">STEP 1 - Find your PC's IP address:</Run>
                        <LineBreak />
                        <Run>On your PC, open CMD and type:  </Run>
                        <Run FontWeight="Bold" Foreground="#FFD54F">ipconfig</Run>
                        <LineBreak />
                        <Run>Look for "IPv4 Address" (e.g. 192.168.1.100)</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">STEP 2 - F1 25 Console Settings:</Run>
                        <LineBreak />
                        <Run>Settings > Telemetry > UDP Telemetry = On</Run>
                        <LineBreak />
                        <Run FontWeight="Bold" Foreground="#FFD54F">UDP IP = your PC's IP (e.g. 192.168.1.100)</Run>
                        <LineBreak />
                        <Run FontWeight="Bold" Foreground="#FFD54F">UDP Port = 20778  |  Format = 2025</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">STEP 3 - SimHub (same as PC Step 2):</Run>
                        <LineBreak />
                        <Run>Home > Codemasters F1 25 > Game config > </Run>
                        <Run FontWeight="Bold" Foreground="#FFD54F">UDP Port = 20777</Run>
                        <LineBreak /><LineBreak />
                        <Run FontWeight="Bold" Foreground="#2EC4B6">Requirements:</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">- Console and PC must be on the same local network (Wi-Fi or Ethernet)</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">- Windows Firewall must allow incoming UDP on port 20778</Run>
                        <LineBreak />
                        <Run Foreground="#7B8CA3">- SimHub must be running on the PC during the session</Run>
                    </TextBlock>
                </StackPanel>
            </styles:SHSection>

            <!-- About -->
            <styles:SHSection Title="About">
                <StackPanel Margin="10">
                    <TextBlock Foreground="#7B8CA3" FontSize="12" TextWrapping="Wrap">
                        <Run FontWeight="Bold" Foreground="#2EC4B6">Overtake Race Hub</Run>
                        <Run> &#x2014; The ultimate F1 25 league management platform.</Run>
                        <LineBreak />
                        <Run>Automatic standings, driver stats, incident reports and more.</Run>
                    </TextBlock>

                    <TextBlock Margin="0,10,0,0" FontSize="11">
                        <Hyperlink Foreground="#2EC4B6"
                                   NavigateUri="https://racehub.overtakef1.com/"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            racehub.overtakef1.com
                        </Hyperlink>
                        <Run Foreground="#3D4F6B">  |  </Run>
                        <Hyperlink Foreground="#2EC4B6"
                                   NavigateUri="https://racehub.overtakef1.com/downloads"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            Downloads
                        </Hyperlink>
                        <Run Foreground="#3D4F6B">  |  </Run>
                        <Hyperlink Foreground="#2EC4B6"
                                   NavigateUri="https://racehub.overtakef1.com/guide"
                                   RequestNavigate="Hyperlink_RequestNavigate">
                            Guide
                        </Hyperlink>
                    </TextBlock>

                    <Border Background="#1A1A2E" CornerRadius="6" Padding="12,10" Margin="0,12,0,0">
                        <StackPanel>
                            <TextBlock FontWeight="Bold" Foreground="#2EC4B6" FontSize="11"
                                       Text="&#x1F512;  Privacy &amp; Bandwidth" Margin="0,0,0,6" />
                            <TextBlock Foreground="#7B8CA3" FontSize="11" TextWrapping="Wrap">
                                <Run FontWeight="Bold" Foreground="#E0E0E0">This plugin works 100% offline.</Run>
                                <Run> All telemetry is received locally from the game via UDP (localhost or LAN) and saved as a file on your PC. No race data is ever sent to the internet.</Run>
                            </TextBlock>
                            <TextBlock Foreground="#7B8CA3" FontSize="11" TextWrapping="Wrap" Margin="0,6,0,0">
                                <Run FontWeight="Bold" Foreground="#E0E0E0">Internet usage: near zero.</Run>
                                <Run> The only network request is a single check (~200 bytes) when SimHub starts, to notify you of new plugin versions. This can be ignored safely.</Run>
                            </TextBlock>
                            <TextBlock Foreground="#3D4F6B" FontSize="10" Margin="0,8,0,0" TextWrapping="Wrap"
                                       Text="Game &#x2192; UDP (local) &#x2192; Plugin &#x2192; JSON file (local disk). No data leaves your computer." />
                        </StackPanel>
                    </Border>
                </StackPanel>
            </styles:SHSection>

        </StackPanel>
    </ScrollViewer>
</UserControl>
